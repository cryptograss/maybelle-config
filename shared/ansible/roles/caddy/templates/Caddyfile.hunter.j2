# Auto-generated Caddyfile for Magenta multi-user environment

{% for user in users %}
# {{ user.full_name }} - Port range {{ user.port_range_start }}-{{ user.port_range_start + 9 }}
{% for i in range(10) %}
{{ user.name }}{{ i }}.{{ base_domain }} {
    reverse_proxy localhost:{{ user.port_range_start + i }}
}

{% endfor %}
# {{ user.full_name }} - code-server
code.{{ user.name }}.{{ base_domain }} {
    reverse_proxy localhost:{{ 18080 + (user.ssh_port - 2222) }}
}

# {{ user.full_name }} - PickiPedia preview (runs as sibling container on port 4005)
pickipedia.{{ user.name }}.{{ base_domain }} {
    reverse_proxy localhost:{{ 4005 + (user.ssh_port - 2222) }}
}

# {{ user.full_name }} - Arthel (Eleventy dev server on port 4000 inside container, mapped to first port in range)
arthel.{{ user.name }}.{{ base_domain }} {
    reverse_proxy localhost:{{ user.port_range_start }}
}

{% endfor %}
